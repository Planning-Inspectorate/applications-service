openapi: 3.0.3
info:
  title: Applications Service API Documentation
  description: API to <ul><li>create, retrieve and modify planning applications</li></ul>
  version: 1.0.5
  license:
    name: MIT
    url: 'https://opensource.org/licenses/MIT'
servers:
  - url: '{environment}/'
    variables:
      environment:
        default: 'http://localhost:3000'
        enum:
          - 'http://localhost:3000'
          - 'https://applications-service-api.azurewebsites.net'
paths:
  '/api/v1/applications/{id}':
    get:
      summary: Returns an existing application
      description: Returns an existing application (Project) by id (Case Reference)
      tags:
        - Applications
      parameters:
        - in: path
          name: id
          example: 'EN010116'
          required: true
          schema:
            type: string
          description: Unique identifier
      responses:
        '200':
          description: Returns an application
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Application'
        '404':
          description: The application could not be found
        '406':
          description: Application not eligible
  '/api/v1/applications':
    get:
      summary: Returns all existing applications
      description: Returns all existing applications (Projects)
      tags:
        - Applications
      responses:
        '200':
          description: Returns all applications
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  $ref: '#/components/schemas/Application'
        '404':
          description: No applications found
  '/test':
    get:
      summary: Returns a list of log messages relating to database connectivity.
      responses:
        '200': # status code
          description: A JSON array of log messages
          content:
            application/json:
              schema:
                type: array
                items:
                  type: string
        '500': # status code
          description: Something went wrong.
        default:
          description: Something went wrong.
  '/api/v1/interested-party/{caseRef}':
    get:
      summary: Returns an existing interested party
      description: Returns an existing interested party by case reference
      tags:
        - Interested Party
      parameters:
        - in: path
          name: caseRef
          example: 'EN010009'
          required: true
          schema:
            type: string
          description: Case reference
      responses:
        '200':
          description: Returns an interested party
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InterestedParty'
        '404':
          description: The application could not be found
  '/api/v1/interested-party':
    post:
      summary: Creates an interested party
      description: Creates an interested party for a project
      tags:
        - Interested Party
      requestBody:
        description: Interested party details
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/InterestedPartyReqBody'
            examples:
              me:
                summary: An example of a request body when submitting on own behalf
                value:
                  case_ref: 'EN010009'
                  behalf: 'me'
                  full-name: 'Humpty Dumpty'
                  over-18: 'yes'
                  address:
                    line1: 'Queens Building'
                    line2: 'Queens Wall Street'
                    line3: 'London'
                    postcode: 'HE127TY'
                    country: 'UK'
                  email: 'test@test.com'
                  telephone: '0132232432'
              organisation:
                summary: An example of a request body when submitting on behalf of an organisation
                value:
                  case_ref: 'EN010009'
                  behalf: 'them'
                  full-name: 'Mr Bean'
                  over-18: 'yes'
                  organisation-name: 'Ministry of Coffee and Social Affairs'
                  role: 'Coffee connoisseur'
                  address:
                    line1: 'Coffee Building'
                    line2: 'Coffee Wall Street'
                    line3: 'London'
                    postcode: 'CO127FE'
                    country: 'UK'
                  email: 'test@test.com'
                  telephone: '0132232432'
              agent:
                summary: An example of a request body when submitting on behalf of an agent
                value:
                  case_ref: 'EN010009'
                  behalf: 'you'
                  representing: 'person|organisation|family'
                  representee:
                    full-name: 'Harry Potter'
                    over-18: 'yes'
                    address:
                      line1: '4'
                      line2: 'Privet Drive'
                      line3: 'Little Whinging'
                      postcode: 'RG12 9FG'
                      country: 'UK'
                    email: 'harry.potter@hogwarts.org.uk'
                    telephone: '0132232432'
                  representor:
                    full-name: 'Hermione Granger'
                    over-18: 'yes'
                    address:
                      line1: '95'
                      line2: 'Boar Lane'
                      line3: 'Sellack'
                      postcode: 'HR9 6LR'
                      country: 'UK'
                    email: 'elvin.ali@planninginspectorate.gov.uk'
                    telephone: '0137732432'
                    organisation-name: 'Hogwarts School of Witchcraft and Wizardry'
        required: true
      responses:
        '201':
          description: Returns the ID ( sometimes called web reference, not to be confused with web_ref in db ) of the newly created interested party
          content:
            application/json:
              schema:
                type: string
                example: '30000001'
  '/api/v1/interested-party/{token}':
    post:
      summary: Retrieves an interested party by token
      description: Retrieves an interested party by token and returns the interested party details if email provided in body matches retrieved party's email
      tags:
        - Interested Party
      parameters:
        - in: path
          name: token
          example: 'b03bee6bd65cf4d770ee4d8712d4eaef9b78d50a970b51e1'
          required: true
          schema:
            type: string
          description: Encrypted interested party ID
      requestBody:
        description: Interested party email
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Email'
        required: true
      responses:
        '200':
          description: Returns an interested party
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InterestedParty'
        '404':
          description: Interested party could not be found
  '/api/v1/interested-party/{ID}/comments':
    put:
      summary: Persist interested party's comments
      description: Persist interested party's comments
      tags:
        - Interested Party
      parameters:
        - in: path
          name: ID
          required: true
          schema:
            type: integer
            example: 30000120
          description: Unique identifier
      requestBody:
        description: Interested party comments
        content:
          application/json:
            schema:
              type: object
              properties:
                mode:
                  type: string
                  example: 'draft'
                comments:
                  type: array
                  items:
                    type: object
                    $ref: '#/components/schemas/Comment'
                  required: true
      responses:
        '200':
          description: Comments updated successfully
        '400':
          description: Comments not updated
  '/api/v1/documents/{caseRef}':
    post:
      summary: Returns project documents
      description: Returns project documents
      tags:
        - Documents
      parameters:
        - in: path
          name: caseRef
          example: 'TR040009'
          required: true
          schema:
            type: string
          description: Case reference
      requestBody:
        description: Search and filtering criteria, required page number
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DocumentSearchCriteria'
        required: true
      responses:
        '200':
          description: Returns list of documents
          content:
            application/json:
              schema:
                type: object
                $ref: '#/components/schemas/DocumentListWrapper'
        '404':
          description: No documents found
  '/api/v2/documents?caseRef=&page=&searchTerm=&stage=&type=':
    get:
      summary: Returns project documents
      description: Returns project documents
      tags:
        - Documents
      parameters:
        - in: query
          name: caseRef
          example: 'TR040009'
          required: true
          schema:
            type: string
          description: Case reference
        - in: query
          name: page
          example: 1
          required: false
          schema:
            type: integer
          description: Page number
        - in: query
          name: searchTerm
          example: 'pdf'
          required: false
          schema:
            type: string
          description: Search term
        - in: query
          name: stage
          required: false
          schema:
            type: array
            items:
              type: integer
          description: Stage
        - in: query
          name: type
          required: false
          schema:
            type: array
          description: Type
      responses:
        '200':
          description: Returns list of documents
          content:
            application/json:
              schema:
                type: object
                $ref: '#/components/schemas/DocumentListWrapper'
        '404':
          description: No documents found
  '/api/v1/representations?applicationId=&searchTerm=':
    get:
      summary: Returns project representations
      description: Returns project representations
      tags:
        - Representations
      parameters:
        - in: query
          name: applicationId
          example: 'EN010009'
          required: true
          schema:
            type: string
          description: Case reference
        - in: query
          name: searchTerm
          example: 'Frosty'
          required: false
          schema:
            type: string
          description: Search term
      responses:
        '200':
          description: Returns list of representations
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  $ref: '#/components/schemas/Representation'
        '404':
          description: No representations found
components:
  schemas:
    Application:
      type: object
      properties:
        CaseReference:
          type: string
          example: 'EN010009'
        ProjectName:
          type: string
          example: 'St James Barton Giant Wind Turbine'
        Proposal:
          type: string
          example: 'EN01 - Generating Stations'
        Summary:
          type: string
          example: 'The Project consists of an Energy Recovery Facility (ERF) converting up to 650,000 tonnes per annum ...'
        Stage:
          type: integer
          example: 3
        PromoterName:
          type: string
          example: 'Horizon Dev Environment DJW'
        PromoterFirstName:
          type: string
          example: 'Postman'
        PromoterLastName:
          type: string
          example: 'Pat'
        ApplicantEmailAddress:
          type: string
          example: 'david.white@pins.gsi.gov.uk'
        ApplicantPhoneNumber:
          type: string
          example: '1234'
        WebAddress:
          type: string
          example: ''
        ProjectEmailAddress:
          type: string
          example: 'david.white@pins.gsi.gov.uk'
        Region:
          type: string
          example: 'Wales'
        ProjectLocation:
          type: string
          example: 'St James Barton, BRISTOL THU 16 JAN'
        AnticipatedGridRefEasting:
          type: number
          example: 347128
        AnticipatedGridRefNorthing:
          type: number
          example: 176491
        MapZoomLevel:
          type: number
          example: 7
        LongLat:
          type: array
          items:
            type: string
            example: ['-0.70283147423378', '53.620078025496']
        AnticipatedDateOfSubmission:
          type: string
          example: ''
        AnticipatedSubmissionDateNonSpecific:
          type: string
          example: 'Longâ€” â€“dash'
        DateOfDCOSubmission:
          type: string
          example: '2015-12-10'
        DateOfDCOAcceptance_NonAcceptance:
          type: string
          example: ''
        DateOfPreliminaryMeeting:
          type: string
          example: ''
        ConfirmedStartOfExamination:
          type: string
          example: ''
        DateTimeExaminationEnds:
          type: string
          example: ''
        DateOfRepresentationPeriodOpen:
          type: string
          example: '2017-02-14'
        DateOfRelevantRepresentationClose:
          type: string
          example: '2018-08-01'
        DateRRepAppearOnWebsite:
          type: string
          example: '2017-08-01'
        Stage4ExtensiontoExamCloseDate:
          type: string
          example: ''
        stage5ExtensionToRecommendationDeadline:
          type: string
          example: ''
        Stage5ExtensiontoDecisionDeadline:
          type: string
          example: ''
        DateOfRecommendations:
          type: string
          example: ''
        ConfirmedDateOfDecision:
          type: string
          example: ''
        DateProjectWithdrawn:
          type: string
          example: ''
        sourceSystem:
          type: string
          example: 'HORIZON'
        dateOfNonAcceptance:
          type: string
          example: ''
    InterestedParty:
      type: object
      properties:
        ID:
          type: number
          example: 30000120
        caseref:
          type: string
          example: 'EN010009'
        behalf:
          type: string
          example: 'me'
        mename:
          type: string
          example: 'David White'
        mebuild:
          type: string
          example: 'Temple Quay'
        mestreet:
          type: string
          example: ''
        metown:
          type: string
          example: 'BRISTOL'
        mecounty:
          type: string
          example: ''
        mecode:
          type: string
          example: 'BS1 6PN'
        mecountry:
          type: string
          example: 'United Kingdom'
        memail:
          type: string
          example: 'david.white@planninginspectorate.gov.uk'
        mephone:
          type: string
          example: '0303 111 111'
        orgname:
          type: string
          example: ''
        contactName:
          type: string
          example: ''
        contactJob:
          type: string
          example: ''
        orgbuild:
          type: string
          example: ''
        orgstreet:
          type: string
          example: ''
        orgtown:
          type: string
          example: ''
        orgcounty:
          type: string
          example: ''
        orgcode:
          type: string
          example: ''
        orgcountry:
          type: string
          example: ''
        orgmail:
          type: string
          example: ''
        orgphone:
          type: string
          example: ''
        youname:
          type: string
          example: ''
        youbuild:
          type: string
          example: ''
        youstreet:
          type: string
          example: ''
        youtown:
          type: string
          example: ''
        youcounty:
          type: string
          example: ''
        youcode:
          type: string
          example: ''
        youcountry:
          type: string
          example: ''
        youmail:
          type: string
          example: ''
        youphone:
          type: string
          example: ''
        agname:
          type: string
          example: ''
        agorgname:
          type: string
          example: ''
        agbuild:
          type: string
          example: ''
        agstreet:
          type: string
          example: ''
        agtown:
          type: string
          example: ''
        agcounty:
          type: string
          example: ''
        agcode:
          type: string
          example: ''
        agcountry:
          type: string
          example: ''
        agmail:
          type: string
          example: ''
        agphone:
          type: string
          example: ''
        therep:
          type: string
          example: 'this is my test that form unchanged for non material change projects after ACR051 developed.  Jun 2021'
        validated:
          type: date
          example: '2021-06-22T14:45:46.000Z'
        emailed:
          type: date
          example: '2021-06-22T14:45:46.000Z'
        exported:
          type: date
          example: ''
        web_ref:
          type: number
          example: 1
      description: All of the data and state information for an interested party
    InterestedPartyReqBody:
      type: object
      properties:
        case_ref:
          type: string
        behalf:
          type: string
        full-name:
          type: string
        over-18:
          type: string
        address:
          type: object
          $ref: '#/components/schemas/Address'
        email:
          type: string
        telephone:
          type: string
    DocumentSearchCriteria:
      type: object
      properties:
        pageNo:
          type: number
          example: 1
        searchTerm:
          type: string
          example: ''
    DocumentListWrapper:
      type: object
      properties:
        documents:
          type: array
          items:
            type: object
            $ref: '#/components/schemas/DocumentListGroupByStage'
        totalItems:
          type: number
          example: 3
        itemsPerPage:
          type: number
          example: 20
        totalPages:
          type: number
          example: 1
        currentPage:
          type: number
          example: 1
        filters:
          type: object
          $ref: '#/components/schemas/Filters'
    DocumentListGroupByStage:
      type: object
      additionalProperties:
        # x-additionalPropertiesName: group
        type: object
        $ref: '#/components/schemas/DocumentListGroupByType'
    DocumentListGroupByType:
      type: object
      additionalProperties:
        # x-additionalPropertiesName: group
        type: array
        items:
          type: object
          $ref: '#/components/schemas/Document'
    Document:
      type: object
      properties:
        id:
          type: number
          example: 12601
        dataID:
          type: string
          example: 'TR040009-000004'
        case_reference:
          type: string
          example: 'TR040009'
        Stage:
          type: number
          example: 1
        type:
          type: string
          example: 'Transboundary'
        filter_1:
          type: string
          example: 'Environmental Impact Assessment'
        filter_2:
          type: string
          example: ''
        category:
          type: string
          example: ''
        description:
          type: string
          example: ''
        size:
          type: number
          example: 50427
        mime:
          type: string
          example: 'application/pdf'
        path:
          type: string
          example: 'TR040009/TR040009-000004-Regulation 24 Transboundary Screening document.pdf'
        status:
          type: string
          example: 'Published'
        date_published:
          type: string
          example: '2015-06-10'
        deadline_date:
          type: string
          example: ''
        personal_name:
          type: string
          example: ''
        representative:
          type: string
          example: ''
        who_from:
          type: number
          example: null
        doc_reference:
          type: string
          example: ''
        author:
          type: string
          example: ''
        details:
          type: string
          example: ''
        last_modified:
          type: string
          example: '2016-04-28 08:42:58'
        date_created:
          type: string
          example: '2016-04-28 08:42:58'
    Address:
      type: object
      properties:
        line1:
          type: string
        line2:
          type: string
        line3:
          type: string
        postcode:
          type: string
        country:
          type: string
          example: 'UK'
    Comment:
      type: object
      properties:
        type:
          type: string
          example: 'Traffic'
        comment:
          type: string
          example: 'I dont like traffic'
    Email:
      type: object
      properties:
        email:
          type: string
          example: 'elvin.ali@planninginspectorate.gov.uk'
    Filters:
      type: object
      properties:
        stageFilters:
          type: array
          items:
            type: object
            $ref: '#/components/schemas/Filter'
        typeFilters:
          type: array
          items:
            type: object
            $ref: '#/components/schemas/Filter'
    Filter:
      type: object
      properties:
        name:
          type: string
        count:
          type: number
    Representation:
      type: object
      properties:
        ID:
          type: number
          example: 2
        ProjectName:
          type: string
          example: 'SPT Feb 2020'
        CaseReference:
          type: string
          example: 'EN010009'
        DataID:
          type: number
          example: null
        UniqueReference:
          type: string
          example: 'WS010006-34601'
        WebReference:
          type: number
          example: null
        PersonalName:
          type: string
          example: 'Test (Test)'
        Representative:
          type: string
          example: null
        IndvdlOnBhalfName:
          type: string
          example: null
        OrgOnBhalfName:
          type: string
          example: null
        AgentOrgOnBhalfContactName:
          type: string
          example: null
        RepFrom:
          type: string
          example: 'Members of the Public/Businesses'
        InterestInLand:
          type: string
          example: null
        SpecifyOther:
          type: string
          example: null
        CompulsoryAcquisitionHearing:
          type: string
          example: null
        RepresentationOriginal:
          type: string
          example: null
        RepresentationRedacted:
          type: string
          example: 'Some comments'
        RelevantOrNot:
          type: string
          example: null
        SubmitFurtherWrittenReps:
          type: string
          example: null
        PreliminaryMeeting:
          type: string
          example: null
        OpenFloorHearings:
          type: string
          example: null
        IssuesSpecificHearings:
          type: string
          example: null
        DateRrepReceived:
          type: date
          example: '2020-02-19T00:00:00.000Z'
        DoNotPublish:
          type: string
          example: null
        Attachments:
          type: string
          example: 'WS010006-000002'
