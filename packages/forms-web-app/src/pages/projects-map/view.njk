{% extends "layouts/default.njk" %}

{% set pageTitle = t('projectsMap.pageTitle') %}

{% if mapAccessToken %}
	{% block stylesheet %}
		<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/OrdnanceSurvey/os-api-branding@0.3.1/os-api-branding.css"/>
		<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ol@v7.4.0/ol.css"/>
		<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ol-ext@4.0.38/dist/ol-ext.min.css"/>
	{% endblock %}

	{% block script %}
		{% set initiateScriptsConfig = (initiateScriptsConfig.push(
			{
				src: "https://cdn.jsdelivr.net/gh/OrdnanceSurvey/os-api-branding@0.3.1/os-api-branding.js"
			},
			{
				callback: "var projectsMap = new appScripts['projects-map'].default(); projectsMap.initiate('" + mapAccessToken + "', 'projects-map', " + mapGeoJSON + ");",
				src: "/public/scripts/projects-map.script.js"
			},
			{ src: "/public/scripts/checkbox-accordion.script.js" },
			{
				callback: "var modal = new appScripts.modal(); modal.initiate('#projects-map-filters', '.ui-checkbox-accordion__modal-close-btn', '#projects-map-search-bar', 'Show filters', 'tablet');",
				src: "/public/scripts/modal.script.js"
			}
		), initiateScriptsConfig) %}
	{% endblock %}
{% endif %}

{% block content %}
	{% set showFilterPanel = query.showFilters or activeFilters | length %}
	<form method="get" action="/projects-map">
	<div class="govuk-grid-row">
		<div class="govuk-grid-column-one-third{{ '' if showFilterPanel else ' projects-map__filters--hidden-on-tablet' }}">
			{% include "./includes/filters.njk" %}
		</div>

		<div class="{{ 'govuk-grid-column-two-thirds' if showFilterPanel else 'govuk-grid-column-full' }} projects-map__content">
			<h1 class="govuk-heading-xl govuk-!-margin-bottom-4">
				{{ t('projectsMap.heading1') }}
			</h1>

			<p class="govuk-body">
				{{ t('projectsMap.paragraph1') }}
			</p>

			{% include "./includes/search.njk" %}

			{% include "./includes/active-filters.njk" %}

			<div class="pins-map">
				<div class="pins-map__container">
					{% include "./includes/map.njk" %}
				</div>
			</div>

			<div class="govuk-warning-text govuk-!-margin-top-4">
				<span class="govuk-warning-text__icon" aria-hidden="true">!</span>
				<strong class="govuk-warning-text__text">
					<span class="govuk-visually-hidden">Warning</span>
					{{ t('projectsMap.warningText') }}
				</strong>
			</div>
		</div>
	</div>
	</form>
{% endblock %}
