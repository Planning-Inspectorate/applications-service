{% extends "layouts/project-3-columns.njk" %}
{% from "../macros/pagination-bar.njk" import paginationBar %}

{% set activeProjectLink = 'about-the-application' %}
{% block contentHeader %}
  <div class="govuk-grid-row">
    <h2 class="govuk-heading-l">Project application documents</h2>
        <p>
          <input class="govuk-input govuk-!-width-one-half" id="search" name="searchTerm" type="text" value="{{ searchTerm }}">
          <button class="govuk-button" data-cy="search-button">Search</button>
        </p>
  </div>
{% endblock %}
{% block columnTwo %}
  <div class="govuk-grid-row">
    {% if documents %}
    <p class="hmcts-pagination__results">Showing <b>{{ paginationData.fromRange }}</b> to <b>{{ paginationData.toRange }}</b> of <b>{{ paginationData.totalItems }}</b> documents, newest first.</p>
      <strong></p>

      <ul class="pins-govuk-result-list">
        {% for document in documents %}
          <li class="pins-govuk-result-list__item">
            <a class="govuk-link pins-govuk-result-list__item-title" href="{{ document.path }}"target="_blank">
              {{ document.description or document.personal_name  }} ({{ document.mime | formatMimeType }}, {{ document.size | formatBytes }})
            </a>
            <p class="pins-govuk-result-list__item-description ">
              {% if document.representative %}
                Published by {{ document.representative }} on behalf of {{ document.personal_name }}
              {% elseif document.description and document.personal_name %}
                Published by {{ document.personal_name }}
              {% endif %}
            </p>
            <div class="govuk-grid-row document-metadata">
              <div class="govuk-grid-column-one-third" data-cy="published-date">
                {{ document.date_published }}
              </div>
              <div class="govuk-grid-column-one-third" data-cy="published-stage">
                {{ projectStageNames[document.Stage] }}
              </div>
              <div class="govuk-grid-column-one-third" data-cy="published-title">
                {{ document.filter_1 }}
              </div>
            </div>
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <p style="govuk-body" data-cy="no-docs-text">
        No documents were found matching your search terms.
      </p>
      <p style="govuk-body">
        Would you like to clear your search and view all documents instead? <a style="govuk-link" href="/projects/{{ caseRef }}/documents/1" data-cy="clear-search">Clear search</a>
      </p>
    {% endif %}

    {% if documents %}
        {% set pageLinkTemplate -%}
          /projects/{{ caseRef }}/documents/:page{{ queryUrl }}
        {%- endset %}
        {{ paginationBar(pageOptions, paginationData, pageLinkTemplate) }}
    {% endif %}
  </div>
{% endblock %}


{% block columnThree %}
  <div class="govuk-grid-row govuk-!-margin-left-3 govuk-!-margin-right-3">
        {% set projectStageFilter %}
          {{ govukCheckboxes({ classes: "govuk-checkboxes--small", idPrefix: "stage",
          name: "stage", items: modifiedStageFilters }) }}
        {% endset %}
        {% set top5ProjectTypeFilter %}
          {{ govukCheckboxes({ classes: "govuk-checkboxes--small", idPrefix: "top5Type",
          name: "type", items: top5TypeFilters }) }}
        {% endset %}
        {% set otherProjectTypeFilter %}
          {{ govukCheckboxes({ classes: "govuk-checkboxes--small", idPrefix: "otherType",
          name: "other", items: otherTypeFilters }) }}
        {% endset %}        
      <div style="background-color: #f3f2f1; padding: 10px;">
      <h2 class="govuk-heading-m">Filter by</h2>

      {{ govukAccordion({
          id: "accordion-default",
          classes: "filter-accordion",
          headingLevel: 3,
          items: [
              {
                  heading: {
                      html: '<span class="filter-heading" data-cy="project-stage">Project stage</span>'
                  },
                  content: {
                      html: projectStageFilter
                  }
              },
              {
                  heading: {
                      html: '<span class="filter-heading" data-cy="project-type">Project type</span>'
                  },
                  content: {
                      html: top5ProjectTypeFilter
                  }
              },
              {
                  heading: {
                      html: '<span class="filter-heading" data-cy="everything else">Everything else</span>'
                  },
                  content: {
                      html: otherProjectTypeFilter
                  }
              }              
          ]
          })
      }}

      <button class="govuk-button" data-cy="apply-filter-button">Apply Filters</button>
  </div>
{% endblock %}
