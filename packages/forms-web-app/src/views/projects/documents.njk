{% extends "layouts/default.njk" %}

{% from "govuk/components/button/macro.njk" import govukButton %}
{% from "govuk/components/inset-text/macro.njk" import govukInsetText %}

{% from "../components/layout/slots.njk" import layoutSlots %}
{% from "../components/section/results.njk" import sectionResults %}
{% from "../components/ui/checkbox-accordion.njk" import uiCheckboxAccordion %}
{% from "../components/ui/vertical-tabs.njk" import uiVerticalTabs %}
{% from "../macros/pagination-bar.njk" import paginationBar %}

{% set section = 'project-documents' %}

{% block script %}
	{% set initiateScriptsConfig = (initiateScriptsConfig.push(
		{ src: "/public/scripts/checkbox-accordion.script.js" }
	), initiateScriptsConfig) %}
{% endblock %}

{% block content %}
	<form>
		<div class="govuk-grid-row">
			<div class="govuk-grid-column-one-third">
				{{ layoutSlots(
					[
						uiVerticalTabs(
							null,
							"project-documents",
							[
								{
									hidden: featureHideLink.hideProjectInformationLink,
									id: "examination",
									name: "" + projectName + " project information",
									url: "/projects/" + caseRef + ""
								},
								{
									hidden: featureFlag.hideProjectTimelineLink != true,
									id: "project-timeline",
									name: "Project timeline",
									url: "/projects/project-timeline"
								},
								{
									hidden: featureFlag.allowDocumentLibrary != true,
									id: "project-documents",
									name: "Documents",
									url: "/projects/" + caseRef + "/documents"
								},
								{
									hidden: false,
									id: "representations",
									name: "Relevant Representations (Registration comments)",
									url: "/projects/" + caseRef + "/representations"
								},
								{
									hidden: featureFlag.allowExaminationTimetable != true,
									id: "project-examination-timetable",
									name: "Examination timetable",
									url: "/projects/" + caseRef + "/examination-timetable"
								},
								{
									hidden: featureHideLink.hideAllExaminationDocumentsLink,
									id: "all-examination-documents",
									name: "All Examination documents",
									url: "/projects/all-examination-documents"
								},
								{
									hidden: featureHideLink.hideRecommendationAndDecisionLink,
									id: "recommendations",
									name: "Recommendation and decision",
									url: "/projects/recommendations"
								}
							]
						),
						uiCheckboxAccordion(
							"Filter",
							filters
						),
						uiVerticalTabs(
							"Related guides",
							null,
							[
								{
									hidden: featureHideLink.hideDecisionMakingProcessGuideLink,
									name: "Find out more about the decision making process for national infrastructure projects",
									url:"/decision-making-process-guide"
								},
								{
									name: "Having your say about a national infrastructure project",
									url:"/having-your-say-guide"
								}
							]
						)
					]) }}
			</div>
			<div class="govuk-grid-column-two-thirds">
        <span class="govuk-caption-l">
          {{ projectName }}
        </span>

				<h1 class="govuk-heading-xl">
					{{ title }}
				</h1>

				{% if documents.length != 0 or queryUrl != '' %}
					{% if examinationLibraryDocumentHtml %}
						{{ govukInsetText({ html: examinationLibraryDocumentHtml }) }}
					{% endif %}

					<h2 class="govuk-heading-m">
						Search documents
					</h2>

					<p class="govuk-body">
						Search by author, description or document type.
					</p>

					<div class="govuk-!-margin-bottom-6">
						<div
							class="govuk-form-group govuk-!-display-inline-block govuk-!-margin-0 govuk-!-width-one-half"
						>
							<label class="govuk-label govuk-visually-hidden" for="searchTerm">
								Search documents
							</label>

							<input
								class="govuk-input"
								id="searchTerm"
								name="searchTerm"
								type="search"
								value="{{ searchTerm }}"
							>
						</div>

						{{ govukButton({
							attributes: { "enterkeyhint": "search", "id": "search-button" },
							classes: "govuk-!-margin-0",
							text: "Search",
							type: "Submit"
						}) }}
					</div>
				{% endif %}

				{% if documents.length > 0 %}
					<p>
						Showing <strong>{{ paginationData.fromRange }}</strong> to <strong>{{ paginationData.toRange }}</strong> of
						<strong>{{ paginationData.totalItems }}</strong> documents, newest first.
					</p>

					{% if queryUrl != '' and queryUrl != '?searchTerm=' %}
						<p>
							<a href="{{ baseUrl }}/{{ pageUrl }}">
								Clear all filters
							</a>
						</p>
					{% endif %}

					{{ sectionResults(documents) }}

					{{ paginationBar(
						pageOptions,
						paginationData,
						paginationUrl
					) }}

				{% elseif documents.length == 0 and queryUrl != '' %}
					<p data-cy="no-docs-text">No documents were found matching your search term and filters.</p>
					<p>Would you like to clear your search and filters to view all available documents instead?</p>
					<p><a href="{{ baseUrl }}/{{ pageUrl }}"
								data-cy="clear-search">Clear search and filters</a></p>

				{% elseif documents.length == 0 %}
					<p data-cy="no-docs-text">There are no project application documents available to display at the moment.</p>
					<p><a href="{{ baseUrl }}">Return to the project overview</a></p>
				{% endif %}
			</div>
			<div>
	</form>
{% endblock %}
